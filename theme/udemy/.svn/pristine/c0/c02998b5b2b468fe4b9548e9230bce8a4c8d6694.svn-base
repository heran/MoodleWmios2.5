/**
* course category node
*
* @param id
* @param name
*/
function category(id,name){

    /**
    * category's id
    *
    * @type {int}
    */
    this.id = id;

    /**
    * category's name
    *
    * @type {string}
    */
    this.name = name;

    /**
    * category's parent
    *
    * @type {category}
    */
    this.parent = null;

    /**
    * category's children
    *
    * @type {category[]}
    */
    this.children=[];

    /**
    * add child
    *
    * @param {category} child
    * @returns {bool}
    */
    this.add_child = function(child){
        if(!this.has_child(child)){
            this.children.push(child);
            child.parent = this;
        }
    }

    /**
    * remove one child
    *
    * @param {category} child
    * @returns {category[]} old children list
    */
    this.remove_child = function(child){
        return this.children.splice(this.find_child_index(child),1);
    }

    /**
    * True if has a child
    *
    * @param {category} child
    * @returns {bool}
    */
    this.has_child = function(child){
        return this.find_child_index(child) !== false;
    }

    /**
    * where the child in the children list
    *
    * @param {category} child
    * @returns {int}
    */
    this.find_child_index = function(child){
        for (var i = 0; i < this.children.length; i++) {
            if (this.children[i].id == child.id) {
                return i;
            }
        }
        return false;
    }

    /**
    * @param {string} name
    * @returns {null|category}
    */
    this.get_child_by_name = function(name){
        for(var i in this.children){
            if(this.children[i].name == name){
                return this.children[i];
            }
        }
        return null;
    }

    /**
    * @param {category} root
    * @param {string[]} names
    * @returns {null|category} this.parent
    */
    this.match_parent = function(root, names){
        var parent = root;
        if(names.length){
            for(var i=0; i<names.length ; i++){
                parent = parent.get_child_by_name($.trim(names[i]));
                if(!parent){
                    break;
                }
            }
            if(!parent){
                parent = root;
            }
        }
        parent.add_child(this);
        return parent;
    }
}

/**
*
* @returns {category}
*/
function get_course_category_root(){
    var category_root = new category(0,M.util.get_string('allcategories','theme_udemy'));
    $('select[name=categoryid] option').each(function(i,n){
        var names = $($(n).text().split('/')).map(function(){
            return $.trim(this);
        });
        var name = names[names.length-1] + '';
        var id = $(n).val()-0;
        var node = new category(id, name);
        names.splice(names.length-1,1);
        var parent = node.match_parent(category_root, names);
    });
    return category_root;
}
$(function(){
});