<?php
use wmios\survey as survey;

require_once(dirname(__FILE__).'/../../config.php');
require_once(dirname(__FILE__).'/lib.php');


/** @var survey\activity_wrapper*/
$wrapper = survey\activity_wrapper::instance_from_id(required_param('id',PARAM_INT));

$url = get_config(SURVEYACTIVITYBASE_PLUGIN_NAME,'uri');
$username = get_config(SURVEYACTIVITYBASE_PLUGIN_NAME,'username');
$password = get_config(SURVEYACTIVITYBASE_PLUGIN_NAME,'password');

$surveyclient = new \survey_client($url,$username,$password);

$surveyid = $wrapper->get_activity_instance()->get_instance()->survey_id;

$doctype = "csv";
$reportstext = $surveyclient->export_results($surveyid,$doctype);
$str = base64_decode($reportstext);

$reports=$wrapper->get_activity_instance()->survey_reports($str,true);

$sumq1 = 0;
$sumq2 = 0;
foreach($reports as $data)
{
    $sumq1 += $data['q1'];
    $sumq2 += $data['q2'];
}

$avgq1 = $sumq1/count($reports);
$avgq2 = $sumq2/count($reports);

