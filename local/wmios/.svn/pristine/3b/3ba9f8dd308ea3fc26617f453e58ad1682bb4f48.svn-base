<?php

/**
 * Update or create an answer
 *
 * @package    local
 * @subpackage wmios
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */

require_once(dirname(__FILE__).'/../../../config.php');
require_once(dirname(__FILE__).'/lib.php');
global $USER,$COURSE,$DB;
require_login();
$qandaid = optional_param('qandaid',0,PARAM_ACTION);
$id = optional_param('id',0,PARAM_INT);
$courseid = optional_param('courseid',0,PARAM_INT);
$answer = required_param('answer',PARAM_CLEANHTML);
if(!$courseid){
    print_error(500);
}
if(!$id && !$qandaid){
    print_error(500);
}
require_capability('local/wmios:qanda_update_question',context_course::instance($courseid));


$userid = $USER->id;
if($id){
    $answer_o = wmios_qanda_answer::instance_for_id($id);
    if($answer_o){
        $answer_o->answer = $answer;
        $answer_o->update();
    }
}else{
    $answer_o = wmios_qanda_answer::create($answer,$userid,$qandaid);
    $answer_o_id = $answer_o->id;
}

$wt = optional_param('wt','json',PARAM_ALPHANUMEXT);
switch($wt){
    case 'json':
    echo json_encode(array('status'=>1,'id'=>$answer_o_id));
    break;
}